{% extends "base.html" %}

{% block title %}–ú–æ–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è - ITmatch{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">–ú–æ–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è</h4>
            </div>
            <div class="card-body">
                {% if matches %}
                    <div class="row">
                        {% for match_info in matches %}
                        <div class="col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex align-items-start">
                                        <!-- –ê–≤–∞—Ç–∞—Ä —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ -->
                                        {% if match_info.other_user.avatar_url and match_info.other_user.avatar_url != 'default_avatar.png' %}
                                            <img src="/static/uploads/{{ match_info.other_user.avatar_url }}"
                                        {% else %}
                                            <img src="/static/default_avatar.png"
                                        {% endif %}
                                             class="rounded-circle me-3"
                                             width="80" height="80"
                                             alt="{{ match_info.other_user.username }}"
                                             onerror="this.src='/static/default_avatar.png'">
                                        
                                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                                        <div class="flex-grow-1">
                                            <h5 class="card-title mb-1">{{ match_info.other_user.username }}</h5>
                                            <div class="mb-2">
                                                <span class="badge bg-primary">{{ match_info.other_user.specialization }}</span>
                                                <span class="badge bg-info text-dark">{{ match_info.other_user.experience }}</span>
                                            </div>
                                            
                                            <!-- –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ -->
                                            {% if match_info.last_message %}
                                            <p class="card-text small text-muted mb-1">
                                                {% if match_info.last_message.sender_id == user.id %}
                                                    –í—ã: 
                                                {% endif %}
                                                {{ match_info.last_message.text[:50] }}{% if match_info.last_message.text|length > 50 %}...{% endif %}
                                            </p>
                                            <small class="text-muted">
                                                {{ match_info.last_message.created_at.strftime('%d.%m.%Y %H:%M') }}
                                            </small>
                                            {% else %}
                                            <p class="card-text small text-muted">–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ!</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
                                <div class="card-footer bg-transparent">
                                    <div class="d-flex justify-content-between">
                                        <a href="/user/{{ match_info.other_user.id }}" class="btn btn-outline-primary btn-sm">
                                            –ü—Ä–æ—Ñ–∏–ª—å
                                        </a>
                                        <!-- —á–∞—Ç -->
                                        <a href="/messages/{{ match_info.match.id }}" class="btn btn-success btn-sm">
                                            üí¨ –ù–∞–ø–∏—Å–∞—Ç—å
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <h4>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π</h4>
                        <p class="text-muted">–õ–∞–π–∫–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ª–µ–Ω—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ —Å–≤–æ—é –∫–æ–º–∞–Ω–¥—É!</p>
                        <a href="/feed" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –ª–µ–Ω—Ç—É</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}